<Project>

  <PropertyGroup>
    <ProducesDotNetReleaseShippingAssets>true</ProducesDotNetReleaseShippingAssets>
  </PropertyGroup>

  <!-- Include installer archives and packages which aren't globbed by default. -->
  <Target Name="PublishWindowsDesktopInstallers"
          BeforeTargets="BeforePublish;PublishToAzureDevOpsArtifacts"
          Condition="'$(DotNetBuildRepo)' == 'true'">
    <!-- Retrieve windows desktop runtime pack product version.
         Don't stabilize the package version in order to retrieve the VersionSuffix. -->
    <MSBuild Projects="$(RepoRoot)src/windowsdesktop/src/sfx/Microsoft.WindowsDesktop.App.Runtime.sfxproj"
             Targets="ReturnProductVersion"
             Properties="IsShipping=false">
      <Output TaskParameter="TargetOutputs" ItemName="WindowsDesktopRuntimePackProductVersion" />
    </MSBuild>

    <ItemGroup>
      <ItemsToPushToBlobFeed Include="$(ArtifactsPackagesDir)**\*.zip;
                                      $(ArtifactsPackagesDir)**\*.exe;
                                      $(ArtifactsPackagesDir)**\*.msi"
                             ManifestArtifactData="NonShipping=false"
                             PublishFlatContainer="true"
                             RelativeBlobPath="WindowsDesktop/$(WindowsDesktopRuntimePackProductVersion)/%(Filename)%(Extension)" />
    </ItemGroup>
  </Target>

</Project>
